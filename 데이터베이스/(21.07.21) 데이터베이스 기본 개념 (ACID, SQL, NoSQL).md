# 데이터베이스 기본 개념 (ACID, SQL, NoSQL)

## 데이터베이스의 본질과 CRUD
- INPUT (DB 데이터 입력) 파악하기 : Create, Update, Delete
- OUTPUT (DB 데이터 출력) 파악하기 : Read

***

## 데이터베이스의 필요성

### 1. 데이터베이스의 필요성과 데이터 저장 방식

- 인메모리(In-memory)
  - 임시 데이터 저장 방식으로 프로그램이 종료되면 사용하던 데이터가 사라짐
  - 저장한 데이터가 프로그램의 실행에 의존하며, 데이터의 수명이 프로그램의 수명에 의존

- File I/O
  - 파일에 데이터를 저장하여 읽은 방식으로 작동하는 형태로 파일에 저장해주면 데이터는 사라지지 않음 (CSV 파일, 액셀 시트 등)
  - 원하는 데이터만 가져올 수 없고 데이터가 필요할 때마다 전체 파일을 매번 읽어야 해서 비효율적
  - 엑셀 시트와 CSV 등 특정 형태의 파일은 대용량의 데이터를 저장하기 위한 목적이 아님

- 관계형 데이터베이스
  - 하나의 CSV 파일이나 엑셀 시트를 한 개의 테이블로 저장할 수 있습니다. 
  - 한번에 여러 개의 테이블을 가질 수 있기 때문에 SQL 을 활용해 데이터를 불러오기 수월함 

### 2. 데이터 베이스와 SQL

- 데이터 베이스는 무엇인가?
  - 데이터베이스 : 데이터 관리와 필터링에 특화된 서버
  - 엑셀 스프레드시트와 유사하며 column과 row가 있음
  - 필터 기능 있음 (query 통해서)
  - 자체 보안 기능과 권한 기능이 있음 (mysql -u root : 루트 원한)

- Query : 질의문이란 뜻으로 저장되어 있는 정보를 필터 하기 위한 질문 (검색창에 적는 검색어도 query의 일종)

- SQL (Structured Query Language)
  - 데이터베이스용 프로그래밍 언어
  - 데이터베이스에 query를 보내 원하는 데이터만 뽑아낼 수 있음
  - 데이터 베이스와 소통하기 위한 SQL 언어 학습 필요

- 클라이언트, 서버, 데이터베이스 작동 예시
  - 클라이언트 → 서버 : 남자 직원 목록 보여줘
  - 서버 → 데이터베이스 : SELECT * FROM employee WHERE gender='M';
  - 데이터베이스는 필터된 데이터를 보여줌

***

## ACID
- 트랜젝션 : 데이터베이스의 상태를 변환시키는 논리적 기능을 수행하기 위해 행해지는 하나 이상의 쿼리를 모아놓은 하나의 작업 단위 (예시 : 계좌이체)
- ACID : 데이터베이스 트랜젝션의 특성으로, 트랜젝션 발생 시 그 안정성 보장할 수 있는 성질

### 1. Atomicity (원자성)
- 하나의 트랜젝션 내에 속해있는 모든 작업이 전부 성공하거나 전부 실패해야 함
- 예시 : A가 B에게 만원을 송금하면 A는 출금이 되고 B는 입금이 되어야 하며, 둘 중 하나만 일어나면 안됨

### 2. Consistency (일관성)
- 하나의 트랜젝션 전후에 데이터베이스의 일관된 상태가 유지되어야 하고 이전과 같이 유효해야 함
- 트랜잭션이 일어난 이후의 데이터베이스는 데이터베이스의 제약이나 규칙을 만족해야 한다는 뜻
- 예시 : 통장을 만들 때 반드시 고객의 이름 데이터가 포함되어야 함 (이름 없는 통장 개설 또는 기존 통장의 이름 삭제하는 쿼리는 위반)

### 3. Isolation (격리성, 고립성)
- 모든 트랜잭션은 다른 트랜잭션으로부터 독립되어야 하며 각각은 트랜젝션은 독립적이며 서로의 연산을 확인받거나 영향을 줄 수 없음
- 동시에 여러 개의 트랜잭션들이 수행될 때, 각 트랜젝션은 고립(격리)되어 있어 연속으로 실행된 것과 동일한 결과

### 4. Durability (지속성)
- 하나의 성공된 트랜젝션에 대한 로그가 기록되고 영구적으로 남음
- 런타임 오류나 시스템 오류가 발생하더라도 해당 기록은 영구적이어야 함
- 예시1 : 계좌이체를 성공적으로 실행한 뒤에, 은행 데이터베이스에 오류가 발생해 종료되더라도 계좌이체 내역은 기록으로 남아야 함 (200)
- 예시2 : 반대로 계좌이체를 로그로 기록하기 전에 시스템 오류 등에 의해 종료가 된다면, 해당 이체 내역은 실패로 돌아가고 각 계좌들은 계좌이체 이전 상태들로 돌아가게 됨 (500)

***

## SQL vs NoSQL

### 1. SQL(구조화 쿼리 언어) vs NoSQL(비구조화 쿼리 언어)

- 관계형 데이터베이스 : SQL(Structured Query Language) 기반
  - 테이블의 구조와 데이터 타입 등을 사전에 정의하고, 테이블에 정의된 내용에 알맞은 형태의 데이터만 삽입할 수 있음 
  - 행(row)과 열(column)로 구성된 테이블에 데이터를 저장하고, 각 열은 하나의 속성에 대한 정보를 저장하며 행에는 각 열의 데이터 형식에 맞는 데이터 저장
  - 데이터를 정확히 입력했다면 데이터를 사용할 때에는 매우 수월
  - 스키마가 뚜렷하게 보인다 : 관계형 데이터베이스에서는 테이블 간의 관계를 직관적으로 파악할 수 있다는 뜻 (스키마에 따라 데이터 입력해야 함)
  - 중복 데이터를 최소화하기 위해 여러 테이블을 분리하며, 이것을 하나의 테이블을 하나로 조회하기 위해 JOIN 사용
  - 대표적 프로그램 :  MySQL, Oracle, SQLite, PostgresSQL, MariaDB

- 비관계형 데이터베이스 : NoSQL 기반
  - 주로 데이터가 고정되어 있지 않은 데이터베이스이며 UnQL(UnStructured Query Language)이라고 말하기도 함
  - schema on read 방식 : 데이터를 읽어올 때 스키마에 따라 데이터를 읽어옴
  - 읽어올 때에만 데이터 스키마가 사용된다고 하여, 데이터를 쓸 때 정해진 방식이 없다는 의미는 아님 (데이터를 입력하는 방식에 따라, 데이터를 읽어올 때 영향 미침)
  - 대표적 프로그램 : 몽고DB, Casandra

### 2. NoSQL 기반의 비관계형 데이터베이스의 구성
- Key-Value 타입 : 속성을 Key-Value의 쌍으로 나타내는 데이터를 배열의 형태로 저장 (예시 : Redis, Dynamo)

- 문서형(Document) 데이터베이스 : 데이터를 테이블이 아닌 문서처럼 저장하는 데이터베이스를 의미 (예시 : MongoDB)
  - 많은 경우 JSON과 유사한 형식의 데이터를 문서화하여 저장
  - 각각의 문서는 하나의 속성에 대한 데이터를 가지고 있고, 컬렉션이라고 하는 그룹으로 묶어서 관리

- Wide-Column 데이터베이스 : 데이터베이스의 열(column)에 대한 데이터를 집중적으로 관리하는 데이터베이스 (예시 : Cassandra, HBase)
  - 각 열에는 key-value 형식으로 데이터가 저장되고, 컬럼 패밀리(column families)라고 하는 열의 집합체 단위로 데이터를 처리
  - 하나의 행에 많은 열을 포함할 수 있어서 유연성을 높음
  -  데이터 처리에 필요한 열을 유연하게 선택할 수 있다는 점에서 규모가 큰 데이터 분석에 주로 사용되는 데이터베이스 형식

- 그래프(Graph) 데이터베이스 : 자료구조의 그래프와 비슷한 형식으로 데이터 간의 관계를 구성하는 데이터베이스 (예시 : Neo4J, InfiniteGraph)
  - 노드(nodes)에 속성별(entities)로 데이터를 저장
  - 각 노드간 관계는 선(edge)으로 표현

### 3. SQL 기반의 데이터베이스와 NoSQL 데이터베이스의 차이점

- 데이터 저장(Storage)

  - 관계형 데이터베이스 : SQL을 이용해서 데이터를 테이블에 저장하며, 미리 작성된 스키마를 기반으로 정해진 형식에 맞게 데이터를 저장

  - NoSQL: key-value, document, wide-column, graph 등의 방식으로 데이터를 저장합니다.

- 스키마(Schema)

  - SQL : 고정된 형식의 스키마가 필요한데 처리하려는 데이터 속성별로 열(column)에 대한 정보를 미리 정해두어야 함. 스키마는 나중에 변경하게 되면 데이터베이스 전체를 수정하거나 오프라인(down-time)으로 전환할 필요가 있음

  - NoSQL : 관계형 데이터베이스보다 동적으로 스키마의 형태를 관리할 수 있으며, 행을 추가할 때 즉시 새로운 열을 추가할 수 있고 개별 속성에 대해서 모든 열에 대한 데이터를 반드시 입력하지 않아도 됨

- 쿼리(Querying) : 데이터베이스에 대해서 정보를 요청하는 질의문

  - 관계형 데이터베이스 : 테이블의 형식과 테이블간의 관계에 맞춰 데이터를 요청해야하므로 SQL과 같이 구조화된 쿼리 언어를 사용

  - 비관계형 데이터베이스 : 쿼리는 데이터 그룹 자체를 조회하는 것에 초점을 두고 있어서 구조화 되지 않은 쿼리 언어로도 데이터 요청이 가능

- 확장성(Scalability)

  - SQL 기반의 관계형 데이터베이스

    - 수직적으로 확장(서버 성능 개선)하며 높은 메모리, CPU를 사용하는 확장이라고도 함 

    - 데이터베이스가 구축된 하드웨어의 성능을 많이 이용하기 때문에 비용이 많이 듬

    - 여러 서버에 걸쳐서 데이터베이스의 관계를 정의할 수 있지만, 매우 복잡하고 시간이 많이 소모됨

  - NoSQL로 구성된 데이터베이스 

    - 수평적으로 확장(서버 개수 추가)하며 보다 값싼 서버 증설, 또는 클라우드 서비스 이용하는 확장이라고도 함 

    - NoSQL 데이터베이스를 위한 서버를 추가적으로 구축하면, 많은 트래픽을 보다 편리하게 처리할 수 있음 

    - 저렴한 범용 하드웨어나 클라우드 기반의 인스턴스에 NoSQL 데이터베이스를 호스팅할 수 있어서, 수직적 확장보다 상대적으로 비용이 저렴

### 4. 케이스에 따른 SQL와 NoSQL 선택

- SQL 기반의 관계형 데이터베이스를 사용하는 케이스

  - 데이터베이스의 ACID 성질을 준수해야 하는 경우 : 데이터베이스와 상호 작용하는 방식을 정확하게 규정할 수 있기 때문에 데이터베이스의 무결성을 보호 (전자 상거래를 비롯한 모든 금융 서비스를 위한 소프트웨어 개발)

  - 소프트웨어에 사용되는 데이터가 구조적이고 일관적인 경우 : 많은 서버를 필요로 하지 않고 일관된 데이터를 사용하는 경우 다양한 데이터 유형과 높은 트래픽을 지원하도록 설계된 NoSQL 데이터베이스를 사용해야만 하는 이유가 없음

- NoSQL 기반의 비관계형 데이터베이스를 사용하는 케이스

  - 데이터의 구조가 거의 또는 전혀 없는 대용량의 데이터를 저장하는 경우

  - 클라우드 컴퓨팅 및 저장공간을 최대한 활용하는 경우 : 클라우드 기반으로 데이터베이스 저장소를 구축하면, 저렴한 비용의 솔루션을 제공받을 수 있음

  - 빠르게 서비스를 구축하는 과정에서 데이터 구조를 자주 업데이트 하는 경우 : 스키마를 미리 준비할 필요가 없기 때문에 빠르게 개발하는 과정에 매우 유리

***

## 주요 프로그램
- DB engines Ranking : https://db-engines.com/en/ranking
- Oracle : 유료이며 비싸서 큰 기업이나 정부에서 사용
- MySQL : 무료이며 오픈소스
- MongoDB : 관계형 데이터베이스가 아님 (SNS, 사물인터넷의 등장으로 2015년부터 비관계형 데이터베이스 프로그램 쏟아짐)
