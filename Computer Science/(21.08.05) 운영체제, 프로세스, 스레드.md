# 운영체제, 프로세스, 스레드

***

## 운영체제 개요
- 컴퓨터 시스템의 요소 4가지 : 하드웨어(CPU, 메모리, 입출력장치 등), 운영체제, 응용 프로그램(어플리케이션), 유저
- 운영체제(Operating System) : 하드웨어와 어플리케이션 프로그램에 일을 시키는 주체
- 운영체제는 하드웨어 위에서 돌아가고, 응용 프로그램은 운영체제 위에서 돌아감 
- 공부 링크 : https://codex.cs.yale.edu/avi/os-book/OS10/index.html
- 한글 링크 : https://parksb.github.io/article/5.html

### 1. 운영체제 탄생 배경
- 운영체제가 없을 때에는 개발자들이 직접 명령어를 통해 CPU에 접근
- CPU 회사마다 명령어 문법이 달라서 효율성 저하
- 손쉬운 하드웨어 관리를 위해 운영체제 탄생

<img width="550" alt="스크린샷 2021-08-05 오후 12 01 48" src="https://user-images.githubusercontent.com/80403988/128284601-32f7ff5c-02fe-453e-917e-8e23cc31dbe8.png">

### 2. 시스템 자원 관리
- 운영체제는 시스템에게 자원 할당자(Resource allocator) 역할 : 프로세스 단위로 할당
- 컴퓨터 시스템은 CPU 시간, 메모리 공간, 파일 저장소 공간, 입출력 장치 등 다양한 문제를 해결해야 함 
- 운영체제는 이러한 컴퓨터 자원들을 관리하는 제어 프로그램
- CPU가 64bit면 운영체제도 64bit에 맞처야 서로 능력 발휘 가능

### 3. 하드웨어

- CPU (Central Processing Unit))
  - 하드웨어 구성 및 프로세스 관리
  - 1번에 1가지 생각밖에 못하지만 메모리 할당 덕에 동시에 작업하는 것처럼 보임
  - CPU register 크기가 32bit : 42억(2^32)개가 한계이며 4GB램 밖에 사용 못함 (4GB : 40억개)
  - 요즘 CPU는 64bit 사용 : RAM 용량을 아무리 늘려도 수용 가능

- 메모리 관리 (RAM)
  - 제한된 메모리 (RAM)에서 여러 프로그램을 작업해서 할당이 필요
  - CPU가 하드디스크에 갔다오는 속도보다 RAM에 갔다오는 속도가 훨씬 빠름
  - 포인터 : RAM의 메모리 주소
  - C++ 쓰는 이유 : 메모리 관리할 수 있고 빠른 처리 가능

- Storage (SSD, HDD) : file system으로 관리 (폴더 : directory)

### 4. 응용 프로그램 관리
- 응용 프로그램 : 컴퓨터를 이용해 다양한 작업을 하는 것이 목적이며 컴퓨터에게 일을 시킴
- 운영체제에서 응용 프로그램이 실행되고, 시스템 자원을 사용할 수 있도록 권한과 사용자 관리 (보안과 관련)
- 권한을 부여받고 난 후에는, 운영체제가 제공하는 기능을 이용할 수 있음
- 시스템 콜(System call) : 응용 프로그램이 시스템 자원을 사용할 수 있도록, 운영체제 차원에서 다양한 함수(API)를 제공하는 것
- 응용 프로그램 구분 방법 : 운영체제(OS) 위에서 직접 돌아가는지 여부
  - Node.js는 운영체제 위에서 돌아가기 때문에 Node.js로 만든 프로그램은 응용 프로그램
  - React와 React 만든 프로그램은 브라우저에서 돌아가는 HTML 파일이기 때문에 응용 프로그램이 아님
  - 브로우저는 운영체제 위에도 돌아가므로 응용 프로그램

***

## 프로세스, 스레드, 멀티 스레드
- 프로그램 : 하드디스크에 저장함
- 프로세스 : 실행중인 프로그램 (a program in execution)
- 스레스 : 한 프로세스의 조각 (a segment of a process)

### 1. 프로세스(Process)
- 프로세스 : 운영체제에서 실행 중인 하나의 애플리케이션 (OS가 프로그램을 실행하기 위해서 프로세스라는 영역을 만들어 줌)
- 사용자가 애플리케이션을 실행하면, 운영체제로부터 실행에 필요한 메모리를 할당 받아 애플리케이션의 코드를 실행
- 다중 프로세스 : Chrome 브라우저를 두 개 실행하면, 두 개의 프로세스가 생성됨 (하나의 애플리케이션은 여러 프로세스 만들기도 함)

### 2. 스레드(Thread)
- 스레드 : 한 가지 작업을 실행하기 위해 순차적으로 실행한 코드
- 하나의 스레드는 코드가 실행되는 하나의 흐름
- 한 프로세스 내에 스레드가 두 개라면 코드가 실행되는 흐름이 두 개 생긴다는 의미
- node.js : 최대 4개 스레드를 가지며 (운영체제 따라 다름) 개발자가 관리하는 event loop은 싱글 스레드

### 3. 스레드의 특징
- 프로세스 내에서 실행되는 흐름의 단위로 CPU 코어 1개당 스레드는 1개
- 각 스레드마다 하나의 call stack이 존재 (call stack: 실행중인 서브루틴을 저장하는 자료 구조)
- 스레드는 다른 스레드와 독립적으로 동작

### 4. 멀티 스레드(Multi-Thread)
- 멀티 태스킹 : 두 가지 이상의 작업을 동시에 처리하는 것을 의미
- 멀티 프로세스 : 애플리케이션 단위의 멀티 태스킹
- 멀티 스레드 : 애플리케이션 내부에서의 멀티 태스킹
- 덕분에 멀티 태스킹은 꼭 멀티 프로세스를 의미하는 것이 아니며, 하나의 프로세스에도 멀티 스레드를 통해 멀티 태스킹 가능

<img width="600" alt="스크린샷 2021-08-05 오후 1 53 11" src="https://user-images.githubusercontent.com/80403988/128293037-9abd8941-507f-467b-8fbc-61ae584a49ec.png">

### 5. 멀티 스레딩의 장점
- 프로세스를 이용하여 동시에 처리하던 일을 스레드로 구현할 경우, 메모리 공간과 시스템 자원의 소모가 줄어듬
- 스레드 간의 통신이 필요한 경우 별도의 자원을 이용하는 것이 아니라, 전역 변수의 공간 또는 동적으로 할당된 공간인 Heap 영역 이용
- 프로세스 간 통신 방법(IPC)에 비해 스레드 간의 통신 방법이 훨씬 간단
- 시스템의 처리량(Throughput)이 향상되고 자원 소모가 줄어들어 자연스럽게 프로그램의 응답 시간이 단축
- 장점 덕분에 여러 프로세스로 할 수 있는 작업을 하나의 프로세스에서 스레드로 나눠 수행

<img width="450" alt="스크린샷 2021-08-05 오후 1 54 35" src="https://user-images.githubusercontent.com/80403988/128293044-2c6660d0-0728-447d-a10f-62f860e7db2c.png">

### 6. 멀티 스레딩의 문제점
- 멀티 프로세스 기반으로 프로그래밍할 때에는 프로세스 간 공유하는 자원이 없음 (똑 같은 작업을 각각의 스레드가 중복으로 처리 할 수 있음)
- 동일한 자원에 동시에 접근하는 일이 없었지만, 멀티 스레딩을 기반으로 프로그래밍할 때에는 공유하는 자원에 대하여 고민이 필요
- 서로 다른 스레드가 같은 데이터에 접근하고, 힙 영역을 공유하기 때문에 서로 다른 스레드가 서로 사용중인 변수나 자료구조에 접근하여 엉뚱한 값을 읽어오거나 수정하는 일이 발생할 수 있음
- 멀티스레딩 환경에서는 동기화 작업이 필요한데, 동기화를 통해 작업 처리 순서를 제어하고 공유 자원에 대한 접근을 제어
- 데드락(Deadlock, 교착 상태), 뮤텍스(Mutex), 세마포어(Semaphore)
- 스레드에 태스크 분배를 수동으로 해 줘야 함 (반면 JavaScript 비동기는 스스로 태스크 분배)

### 7. 동시성과 병렬성
- 동시에 돌릴 수 있는 스레드 수는 컴퓨터에 있는 코어 갯수로 제한
- 시분할 : 운영체제(또는 가상 머신)는 각 스레드를 시간에 따라 분할하여, 여러 스레드가 일정 시간마다 돌아가면서 실행되도록 함
- Concurrency(동시성, 병행성): 여러 개의 스레드가 시분할 방식으로 동시에 수행되는 것처럼 착각을 불러일으킴
- Parallelism(병렬성): 멀티 코어 환경에서 여러 개의 스레드가 실제로 동시에 수행됨
- Context Switching : 다른 태스크(프로세스, 스레드)가 시작할 수 있도록 이미 실행중인 태스크(프로세스, 스레드)를 멈추는 것

### 8. 비동기(싱글 스레드)와 멀티 스레드
- 멀티 스레드는 정규직을 고용하는 것으로, 수동으로 업무를 분배해야 함
- 비동기 싱글 스레드는 필요할 때마다 계약직을 고용하고 태스크가 끝난 후 계약을 종료하는 것 (병렬x)


### 8. 콜스택 예시 (JavaScript)
```js
function logA() { console.log('A') }
function logB() { console.log('B') }
function logC() { console.log('C') }

logA();
setTimeout(logB, 0);
logC();

// A, C, undefined, B 순으로 실행됨
```
  - 모든 것은 스택에 올라감
  - setTimeOut(x, 0)은 0 밀리세컨드 뒤에 실행하겠다는 뜻 아니라, 스택이 비어 있으면 실행하겠다는 뜻
  - 모든 비동기는 스택이 비워지고 실행되며, 그 전에 별도의 공간인 Event Queue에 들어감 (다른 스레드 관리)
