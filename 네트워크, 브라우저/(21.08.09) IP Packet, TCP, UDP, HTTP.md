# IP Packet, TCP, UDP, HTTP

***

## 인터넷 프로토콜

<img width="500" alt="스크린샷 2021-08-09 오전 11 30 36" src="https://user-images.githubusercontent.com/80403988/128654926-6d12784f-43a8-4d7d-9645-737b52e3c88d.png">

***

## IP와 IP Packet

### 1. IP Packet
- IP : 지정한 IP 주소에 패킷(Packet)이라는 통신 단위로 데이터 전달
- IP Packet (pack + bucket : 소포) : 출발지 IP, 목적지 IP와 같은 정보가 포함
- 패킷 단위로 전송하여 복잡한 인터넷 망 사이에서도 IP 주소를따라 정확한 목적지로 데이터 전달
- 서버와 클라이언트 모두 패킷 단위로 전달

<img width="400" alt="스크린샷 2021-08-09 오전 11 28 46" src="https://user-images.githubusercontent.com/80403988/128654814-4d651f93-ab88-4c1b-8eec-8643e442f5e1.png">

### 2. IP Packet의 한계
- 비연결성 : 패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷 전송 가능 (서버 상태 파악 불가능)
- 비신뢰성 : 중간에 패킷이 사라질 수 있고 패킷의 순서를 보장할 수 없음 (각 패킷들이 서로 다른 노드들 통해 전달)

***

## TCP vs UDP
- TCP (Transmission Control Protocol) 전송 제어 프로토콜
- UDP (User Datagram Protocol)
- 인터넷 계층에 속하는 IP보다 높은 전송 계층에 속한 TCP로 IP의 한계 보완 가능

<img width="450" alt="스크린샷 2021-09-13 오후 5 24 41" src="https://user-images.githubusercontent.com/80403988/133060477-6f7da4db-c295-464e-9f18-814a4460f69e.png">

### 1. 데이터 전달 과정

<img width="600" alt="스크린샷 2021-08-09 오전 11 32 40" src="https://user-images.githubusercontent.com/80403988/128654999-9d4427e1-313c-4842-b09b-07d9b50fa089.png">

- 먼저 HTTP 메시지가 생성되면 Socket 라이브러리를 통해 전달
- 네트워크 소켓(Socket) : 프로그램이 네트워크에서 데이터를 송수신하도록 네트워크 환경에 연결하기 위한 연결부
- 그리고 IP 패킷을 생성하기 전 TCP 세그먼트를 생성
- 생성된 TCP/IP 패킷은 LAN 카드와 같은 물리적 계층을 지나기 위해 이더넷 프레임 워크에 포함되어 서버로 전송

### 2. TCP/IP 패킷
  - TCP 세그먼트 : 출발지 PORT, 목적지 PORT, 전송 제어, 순서, 검증 정보 등 (IP 패킷 정보 보완)
  - IP 세트먼트 : 출발지 IP, 목적지 IP 등
 
 <img width="400" alt="스크린샷 2021-08-09 오전 11 32 46" src="https://user-images.githubusercontent.com/80403988/128655008-ced75e77-9614-4ff3-958d-6005b183cfbe.png">

### 3. TCP 특징
- 연결 지향 : TCP 3 way handshake (가상 연결)

  - SYN : Syncronize / ACK : Acknowledgment

  - 클라이언트는 서버에 접속을 요청하는 SYN 패킷을 보냄
    - 서버의 SYN/ACK 응답을 기다리는 SYN_SENT 상태가 됨

  - 서버는 SYN요청을 받고 클라이언트에게 요청을 수락한다는 ACK 와 SYN flag가 설정된 패킷을 발송
    - 클라이언트의 ACK 응답을 기다리는 SYN_RECEIVED 상태가 됨

  - 클라이언트가 서버에게 ACK을 보내면 이후 연결이 성립되며 데이터를 전송할 수 있음 (서버 상태 : ESTABLISHED)

  - 만약 서버가 꺼져있다면 클라이언트의 SYN에 대한 서버의 응답이 없기 떄문에 클라이언트가 데이터를 보내지 않음

  - 현재에는 최적화가 이루어져 3번 ACK을 보낼때 데이터를 함께 보내기도 함

<img width="500" alt="스크린샷 2021-09-13 오후 5 10 09" src="https://user-images.githubusercontent.com/80403988/133060525-cc37bcbb-dbe5-4a3f-ac84-8a00cd9b7b02.png">

- 데이터 전달 보증 : TCP는 데이터 전송이 성공적으로 이루어진다면 이에 대한 응답을 돌려주어 IP 패킷의 비연결성 보완

- 순서 보장 : 패킷이 순서대로 도착하지 않는다면 TCP 세그먼트에 있는 정보를 토대로 다시 패킷 전송을 요청하여 비신뢰성 보완

### 4. UDP 특징
- 구조 : IP 프로토콜에 PORT, 체크섬 필드 정보만 추가된 단순한 프로토콜
- 체크섬(checksum) : 중복 검사의 한 형태로 오류 정정을 통해 공간(전자 통신)이나 시간(기억 장치) 속에서 송신된 자료의 무결성을 보호하는 단순한 방법
- 비 연결지향 : 신뢰성은 낮지만 3 way handshake 방식을 사용하지 않기 때문에 TCP와 비교해 빠른 속도를 보장
- HTTP3는 UDP를 사용하며 이미 여러 기능이 구현된 TCP보다는 하얀 도화지처럼 커스터마이징이 가능

***

## HTTP의 특징

- HTTP/1.1, HTTP/2 : TCP 기반
- HTTP/3 : UDP 기반

### 1. 클라이언트 서버 구조
- 클라이언트 서버 구조 : 클라이언트가 서버에 요청을 보내면 서버는 그에 대한 응답 보냄
- 무상태 프로토콜 (Stateless) : 서버가 클라이언트의 상태를 보존하지 않음

### 2. 무상태 프로토콜 (Stateless)
- 상태 유지의 경우 (Stateful)
  - 데이터가 서버에 있기 때문에 항상 같은 서버를 유지해야 함
  - 서버에 장애가 생기면 상태정보가 다 날아가므로 처음부터 다시 서버에 재요청해야함

- 무상태 유지 (Stateless)
  - 상태가 없다기 보다는 상태를 저장하지 않음
  - 클라이언트가 이미 필요한 데이터를 다 담아서 보냄
  - 서버 확장성 높음 : 응답 서버를 쉽게 바꿀 수 있어서 갑자기 서버 대거 투입 가능
  - 로그인이 필요한 경우 무상태성을 보완하기 위해 쿠키, 서버 세션, 토큰 등을 이용ㄴ

### 3. 비연결성 (Connectionless)
- 연결을 유지하는 HTTP 모델의 경우 (Connection Oriented)
  - TCP/IP의 경우 기본적으로 연결을 유지
  - 클라이언트가 요청을 보내지 않더라도 계속 연결을 유지해야 하고 서버 자원이 소모됨
- 연결은 유지하지 않는 HTTP 모델의 경우 (Conectionless)
  - HTTP 1.0 기준으로, HTTP는 연결을 유지하지 않는 모델 (기본 모델)
  - 실제로 요청을 주고 받을 때만 연결을 유지하고 응답을 주고나면 TCP/IP 연결을 음
  - 트래픽이 많지 않고 빠른 응답을 제공할 수 있는 경우 비연결성의 특징은 효율적 (단순 검색 등)
  - 트래픽이 많고, 큰 규모의 서비스를 운영할 때에는 비연결성은 한계

### 4. 비연결성의 한계와 극복
- HTTP 초기에는 연결과 종료를 반복하며 시간을 낭비
- TCP/IP 연결을 새로 맺어야 해서 3 way handshakes 시간 추가
- 웹 브라우저로 사이트를 요청하면 HTML 뿐만 아니라 자바스크립트, css, 이미지 등 수 많은 자원 다운로드
- 현재 HTTP 지속 연결(Persistent Connections)로 문제를 해결
- HTTP/2, HTTP/3에서 더 최적화 (HTTP2에서는 비연결성이 무의미하게 됨)

<img width="650" alt="스크린샷 2021-09-13 오후 6 31 47" src="https://user-images.githubusercontent.com/80403988/133060622-065d3864-ae34-4670-9a5b-c8d7af754e12.png">
