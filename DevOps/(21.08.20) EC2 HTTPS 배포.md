# EC2 HTTPS 배포
- EC2 와 ELB(로드 밸런서)를 연결하기

***

## ELB 생성 및 ACM을 통한 인정서 발급
- EC2 메인 콘솔로 이동

- 왼쪽 메뉴 사이드바 : 로드밸런서 클릭

- 로드밸런서 생성 클릭

- 로드밸런서 유형 선택 : Allication Load Balancer - HTTP HTTPS 선택

### 1. Load Balancer 구성
- 이름 : ELB

- 리스너
  - Load Balancer 프로토콜 - HTTP / Load Balancer 포트 - 80

  - Load Balancer 프로토콜 - HTTPS / Load Balancer 포트 - 443

  - 가용영역 : 모두 체크

### 2. 보안 설정 구성

- CloudFront용 인증서와는 별개의 인증서를 만들어야 함 (CloudFront용 인증서는 북미 지역이라 region이 다르기 때문)

- 기본 인증서 선택

  - 인증서 유형 :ACM에서 인증서 선택 (권장)

  - ACM으로부터 새 인증서 요청 클릭

- 인증서 요청

  - 1단계 : 도메인 이름 추가 - 도메인 이름에 원하는 서버 url 추가하기 (ex. server.cheongjigi.com)

  - 2단계 : 검증 방법 선택 - DNS 검색 선택

  - 3단계 : 태그 추가 - 입력하지 않고 '검토' 클릭하여 넘어가기

  - 4단계 : 검토 및 요청 - '확인 및 요청' 클릭

  - 5단계 : 검증 - 'Route 53에서 레코드 생성' 클릭 -> 생성 후 넘어가기

- 기본 인증서 선택 (다시 돌아옴)

  - 인증서 이름 - 생성된 인증서 선택 후 '보안 그룹 구성' 클릭


### 3. 보안 그룹 구성
- 보안 그룹 선택 후 '라우팅 구성' 클릭

### 4. 라우팅 구성
- 대상 그룹
  - 이름 : 원하는 이름 입력하기
  
  - 고급 상태 검사 설정 : 성공 코드 201번으로 수정 후 '대상 등록' 클릭

### 5. 대상 등록
- 인스턴스 : EC2 인스턴스를 체크 표시 후 '등록된 항목에 추가' 클릭

- 등록된 대상 : 선택한 EC2 인스턴스 등록이 되면 '다음:검토' 클릭

### 6. 검토
- 검토 후 '생성' 클릭

- 로드밸런스 메뉴로 다시 돌아가 'DNS 이름 주소'를 이용하여 접속 테스트 진행

***

## 호스팅 영역에 별칭 레코드 생성 (ELB)
- SSL 인증서에 입력된 서버 url을 생성하여, 로드밸런서 url과 연결하기

### 1. Route 메뉴 접속
- Route53 메인 콘솔로 이동

- DNS 관리 호스팅 영역 클릭

- 도메인 이름 클릭

- 레코드 생성 클릭

### 2. 빠른 레코드 생성
- 레코드 이름 : 인증서의 서버 url 입력 (ex. server.cheongjigi.com)

- 별칭 : 'Application/Classic Load Balancer에 대한 별칭' 선택

- 리전 : 아시아 태평양 (서울) 선택

- 로드 밸런서 선택 : 위에서 생선된 로드밸런스 url 선택

- 라우팅 정책 : 단순라우팅

- '레코드 생성' 클릭하여 마무리
